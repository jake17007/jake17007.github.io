<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Jacob Beauchamp</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/landing-page.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
        <div class="container topnav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand topnav" href="index.html">Jacob Beauchamp</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a href="projects.html">Projects</a>
                    </li>
                    <li>
                        <a href="Resume.pdf">Resume</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>


    <!-- Header -->
    <div class="banner-other">

        <div class="container">

            <div class="row">
              <div class="text-center">
                <h2>Connectrix IoT Web App</h2>
                <h3>A platform for secure, personal data aggregation and analysis</h3>
              </div>
            </div>

        </div>
        <!-- /.container -->

    </div>
    <!-- /.banner -->

    <!-- Page Content -->


  <div class="content-section-b">

    <div class="container text-section">
      <div class="col-sm-10 col-sm-offset-1">
        <h2 class="page-header">
          About
        </h2>
        <div class="row">
          <div class="col-sm-8">
            <h4>
              The Problem
            </h4>
            <div>
              <p>The <a href="http://quantifiedself.com/" target="_blank">Quantified Self</a> community is a group of people who track and analyze their lives to gain insight, most often to aid in decision making towards achieving goals -- think counting calories to lose weight. Data from multiple sources can lead to even greater insight.</p>
              <p>
              While platforms for aggregating personal data exist, two limiting factors arise: 1.) The platform takes charge of the analytics and, due to human resource limitations, can only offer a narrow scope of "one-size-fits-all" analyses; or 2.) the platform outsources the analytics to a community of developers, BUT gives them the personal data, reducing privacy and increasing risk for the user.</p>


            </div>

            <h4>
              The Solution
            </h4>
            <div>
              <strong>Connectrix is a platform for personal data analytics that connects personal data sources in the cloud to analytics apps created by a community of developers.</strong> As the picture below depicts, Connectrix pulls in the data and the apps via APIs and runs the apps on our servers, eliminating the need to give app developers access to a user's personal data. In reference to the problems above: 1.) By shifting the creation of analytics apps to a community of developers, users can access all kinds of analyses to find ones that suit their needs. Connectrix also makes it super easy for developers to create and publish these analyses. 2.) As mentioned, privacy risk is reduced by running the apps on Connectrix servers.
            </div>
          </div>
          <div class="col-sm-4">
            <div class="btn-vert-block">
              <a href="https://connectrix-dev.herokuapp.com" target="_blank" type="button" class="btn btn-primary btn-block"><i class="fa fa-external-link fa-fw"></i> Go to Connectrix</a>

              <a href="https://github.com/jake17007/PersonalDataWebApp/tree/production" target="_blank" type="button" class="btn btn-primary btn-block"><i class="fa fa-github fa-fw"></i> View Source Code</a>


              <ul class=" list-group lead btn-block text-center">
                <li class="list-group-item"><strong>Technologies</strong></li>
                <li class="list-group-item"><a href="https://nodejs.org/en/" target="_blank">Node.js</a></li>
                <li class="list-group-item"><a href="https://angularjs.org/" target="_blank">AngularJS</a></li>
                <li class="list-group-item"><a href="https://expressjs.com/" target="_blank">Express</a></li>
                <li class="list-group-item"><a href="https://www.mongodb.com/" target="_blank">MongoDB</a></li>
                <li class="list-group-item"><a href="https://www.python.org/" target="_blank">Python</a></li>
              </ul>
            </div>

          </div>
        </div>
        <div class="row">

          <div class="col-sm-12">

            <div class="row">
              <div class="text-center center-pic">
                <img src="img/connectrix_architecture.png" alt="connectrix graph">
              </div>
            </div>

            <h2 class="page-header">Developing for a Connectrix User</h2>
            <div class="sub-section">
              <h3>
                Establishing Connections
              </h3>
              <div>
                When a user first creates an account and logs in, they need to establish connections to personal data sources. Currently available at the time of this writing are connections to <a href="https://www.fitbit.com/" target="_blank">Fitbit</a>, <a href="https://moves-app.com/" target="_blank">Moves</a>, and <a href="https://www.youtube.com/" target="_blank">YouTube</a>. The user simply clicks a "Connect" button, which redirects them to the provider's website where they allow Connectrix to access their data via API. Once they accept, Connectrix receives an access token, which is essentially the only personal data persisted in the Connectrix database. This occurs via the OAuth 2.0 authorization flow protocol and is implemented with the help of <a href="http://passportjs.org/" target="_blank">Passport</a> (easily integrated since the backend is written in Node.js with the Express framework).
              </div>

              <h3>
                Using Connectrix Apps
              </h3>
              <div>
                After connections have been established, the user may begin using analyses available on the <a href="https://connectrix-dev.herokuapp.com/appStore" target="_blank">Connectrix App Store</a>. When a user finds an app they want to use, they add it to their favorites. Then when they wish to run it (and only then), Connectrix fetches the data via APIs, fetches the program from Github, and runs the data through the program on the Connectrix server. The output is then passed to the client and injected into the webpage for the user's viewing. See "The Process of Running a Connectrix App" below for more details. The user's Dashboard lists their connections and favorite apps.
              </div>
            </div>

            <h2 class="page-header">Developing for a Connectrix Developer</h2>
            <div class="sub-section">
              <h3>
                Selecting Required Connections
              </h3>
              <div>
                Since the responsibility of data aggregation is shifted from the developer to Connectrix and the privacy-preserving data flow disallows developers from ever viewing the data, it becomes very important for them to know exactly what they're getting before hand to build a program that effectively processes that data. For this reason, when an app is created, the developer must indicate which data sources are required for the app to run. Further, a developer can choose from a number of more specific endpoints available for each API; e.g. a developer can choose "<a href="https://dev.fitbit.com/docs/body/#get-body-time-series" target="_blank">Fitbit - Body Weight Time Series</a>" in addition to "<a href="https://dev.moves-app.com/docs/api_storyline" target="_blank">Moves - Storyline</a>."
              </div>
              <h3>
                Developing and Testing Connectrix Apps
              </h3>
              <div>
                <p>The entire process of developing, testing, and publishing a "Hello, world" Connectrix app is detailed in the <a href="https://connectrix-dev.herokuapp.com/developers/developerGuide" target="_blank">Developer Guide</a>. But in general, a developer creates a new app by simply specifying a name and description, selecting the connections required for the app, and pointing Connectrix to a public Github repository where the application is to be stored.</p>
                <p>At this point, the developer can begin writing a Python program that accepts data, processes it, and returns HTML with embedded CSS and JavaScript. When the app is run, the user's data will be fed into the Python program, processed, and the output will be passed to the client and injected into the webpage for the user to view.</p>
                <p>You may be wondering how a developer can test such a program with only a guess of what the user's data will look like. Essentially, they use their own data and test locally on their machine. Having specified the required data connections, they can click a "View JSON" button to see their own actual data received from the APIs in the format that will be fed to their app. Further, Connectrix provides a test engine to test their app locally. After downloading the test engine (a Node.js app), they copy and paste their example JSON into a view.json file and the engine will run their program with their data in the same way that Connectrix would run their program in the online environment. Output is written to an HTML file that the developer can open in a browser to see exactly what the app will look like. When they're done testing, they publish the app by simply pushing the files to their Github repository.</p>
              </div>
            </div>

            <h2 class="page-header">The Process of Running a Connectrix App</h2>
            <div class="sub-section">
              <h3>
                Retrieving User Data
              </h3>
              <div>
                <p>When a user wishes to run an app, a request is made to the Connectrix server with information of the user who made the request and which app they'd like to use. On the server, "Data Getters" are compiled according to the app's required connections and specific third party API endpoints, and they contain the necessary credentials of the user for retrieving the data. These Data Getters are JavaScript functions returning Promises and are run simultaneously with the <code>Promise.all()</code> method.</p>

                <p>However, it is a bit more complex than that; the logic can be thought of as being two levels deep. The top level compiles Data Getters <em>by third party API <u>provider</u></em> (Fitbit, Moves, YouTube), and the lower level compiles Data Getters <em>by third party API <u>endpoint</u></em> (Fitbit - Body Weight Time Series, Fitbit - Calories Burned, etc.). This is to account for error handling at the lower level. For instance, if a request is made to the Fitbit API but the access token used had been expired, the error is caught and handled at the Fitbit level (reading the error in the Fitbit response, refreshing the access token according to Fitbit standards, storing it to the database). Then the API call for data is made again recursively (within limits) in the error handler. This way, each provider may use and reuse their own error handling code, calls for data are not redundant, and everything runs asynchronously.</p>

                <p>See the the <code>runApp</code> function in the <a href="https://github.com/jake17007/PersonalDataWebApp/blob/production/server/api/analysis/analysis.controller.js#L282" target="_blank">source code</a> to begin the journey down the rabbit hole.</p>
              </div>

              <h3>
                Retrieving and Building an App
              </h3>
              <div>
                <p>Since app source code is stored in a public Github repository, retrieving them is done simply with the <a href="https://www.npmjs.com/package/nodegit" target="_blank">nodegit</a> Node module. The files are clones to the Connectrix server's filesystem. However, in order to run apps for multiple users simultaneously, these clones are indexed according to the number of clones currently on the system. (Storing the first directory as "clone-0," a second app run initiated by another user while clone-0 is still present would render a "clone-1," and so on.) The directories are deleting when done processing the data and a response is returned. See the "Security" section below for information about running untrusted code on the server.</p>
                <p>Currently, apps may only be written in Python and use predetermined libraries that have been pre-installed on the server.</p>
              </div>

              <h3>
                Passing Data to an App
              </h3>
              <div>
                After cloning the program to the server and retrieving the user's data, Connectrix spawns a child process (initiating a pre-named <code>app.py</code>  main file) with the <a href="https://www.npmjs.com/package/python-shell" target="_blank">python-shell</a> Node module. This makes it easy to run and listen for data or errors from the Python program. Data is passed to the Python program's stdin stream and received stdout or stderr (most easily a <code>print</code> statement).
              </div>

              <h3>
                App Output
              </h3>
              <div>
                <p>Once the data is received from the Python script, it is returned in the response to the client. Then, it being HTML, it is injected into the app view page's HTML. This HTML output from the app could contain embedded JavaScript and CSS. For example, to create a graph, the developer could use the <a href="http://mpld3.github.io/" target="_blank">mpld3</a> Python library to convert a <a href="https://matplotlib.org/" target="_blank">matplotlib</a> figure to a browser compatible <a href="https://d3js.org/" target="_blank">D3.js</a> graph with full zoom, move, and reset functionality.</p>

                <div class="row">
                  <div class="text-center center-pic">
                    <img src="img/connectrix_graph.png" alt="connectrix graph">
                    <div class="col-sm-8 col-sm-offset-2 img-tag">
                      <small>Screenshot of the "Calories Burned" graph in the "Weight Vs. Calorie Burn" app. See the <a href="https://github.com/jake17007/Connectrix_FitbitWeightVsCalorieBurn" target="_blank">source code</a> for an example of converting from matplotlib to D3.js.</small>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-12">
                    <p>Currently, the injected HTML is able to access and utilize all the resources already in the page such as Bootstrap and JQuery (and AngularJS app), but this should obviously be changed in the future. See the "Security" section below for details.</p>
                  </div>

                </div>

              </div>
            </div>

            <h2 class="page-header">Security</h2>
            <div class="sub-section">
              <div>
                One of the biggest concerns for this application is security. As a centralized trusted-third-party, Connectrix acts as a safe place to process data. However, at this stage, there two vulnerabilities in particular where data could be leaked to another party or other malicious activity could occur.
              </div>
              <h3>
                Malicious Python Script
              </h3>
              <div>
                Currently, the app software is pulled in from Github and built on the Connectrix server -- the same server that runs the Connectrix app. This could be bad for two reasons. First, it could access any part of the filesystem that any other script could and disrupt the application or pull from the database. Second, it could fairly easily send the user's data across the network. To prevent this, the software could instead be built in a virtual machine with no access to the filesystem, and on top of that, in a sandbox that had no network capabilities. I have considered creating such an environment on an Amazon EC2 instance and using the <a href="http://pypy.org/" target="_blank">PyPy</a> sandbox.
              </div>

              <h3>
                Malicious Output
              </h3>
              <div>
                Another vulnerability lies in the fact that the app output is injected into the client application. This means that a malicious JavaScript function could run and access the AngularJS application. Or it could send the user's data across the network. The combat this, I've considered using an iFrame with restrictions to the network.
              </div>
            </div>
          </div>

        </div>


      </div>
    </div>
  </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li>
                            <a href="index.html">Home</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="projects.html">Projects</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="Resume.pdf">Resume</a>
                        </li>
                    </ul>
                    <p class="copyright text-muted small">Created by Jacob Beauchamp 2017</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>

</html>
